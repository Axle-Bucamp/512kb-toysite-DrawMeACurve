<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fourier V12</title><style>*{margin:0;padding:0;box-sizing:border-box}body{background:#050510;font-family:system-ui,sans-serif;color:#fff;min-height:100vh;overflow:hidden}.C{display:grid;grid-template-columns:1fr 300px;height:100vh}@media(max-width:800px){.C{grid-template-columns:1fr;height:auto;overflow-y:auto}}.A{position:relative;background:radial-gradient(circle at center,#1a1a2e 0,#000 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:10px}canvas{box-shadow:0 0 20px rgba(0,255,255,.1);border-radius:4px;background:#000}.S{background:rgba(20,20,30,.95);border-left:1px solid rgba(255,255,255,.1);padding:20px;overflow-y:auto;backdrop-filter:blur(10px)}h1{font-size:24px;background:linear-gradient(to right,#0ff,#0f8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px;font-weight:800}.G{margin-bottom:15px}label{display:flex;justify-content:space-between;font-size:11px;text-transform:uppercase;margin-bottom:5px;color:#88a}input[type=range]{width:100%;height:4px;background:#334;border-radius:2px;appearance:none;outline:none}input[type=range]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;background:#0ff;border-radius:50%;cursor:pointer}select{width:100%;padding:8px;background:#223;border:1px solid #445;color:#fff;border-radius:4px}button{width:100%;padding:10px;margin-top:10px;background:linear-gradient(45deg,#0ff,#06f);border:none;border-radius:6px;color:#fff;font-weight:bold;cursor:pointer}button:hover{filter:brightness(1.2)}.sec{background:#334;color:#ccc}.tabs{display:flex;gap:5px;margin-bottom:20px;background:#223;padding:4px;border-radius:6px}.tab{flex:1;text-align:center;padding:6px;font-size:11px;cursor:pointer;border-radius:4px;color:#889}.tab.act{background:#0ff;color:#000;font-weight:bold}.hid{display:none}.drop{border:2px dashed #445;padding:20px;text-align:center;border-radius:8px;cursor:pointer}.drop:hover{border-color:#0ff}.layers{max-height:150px;overflow-y:auto;margin-bottom:15px;border:1px solid #334;border-radius:4px}.layer{padding:8px;font-size:12px;cursor:pointer;border-bottom:1px solid #334;display:flex;justify-content:space-between}.layer:hover{background:#223}.layer.sel{background:#0ff;color:#000;font-weight:bold}</style></head><body><div class="C"><div class="A"><canvas id="c" width="600" height="600"></canvas><canvas id="c2" width="600" height="150"></canvas></div><div class="S"><h1>‚ö° Fourier V12</h1><div class="tabs"><div class="tab act" onclick="M('draw')">DESSIN</div><div class="tab" onclick="M('spline')">SPLINES</div><div class="tab" onclick="M('fill')">REMPLIR</div><div class="tab" onclick="M('ext')">EXTRAIT</div></div><div class="layers" id="ls"></div><div style="display:flex;gap:5px;margin-bottom:15px"><button onclick="AL()" style="margin:0;background:#223;border:1px solid #445">+</button><button onclick="DL()" style="margin:0;background:#223;border:1px solid #445">-</button><button onclick="TA()" style="margin:0;background:#223;border:1px solid #445;flex:2">üëÅÔ∏è Tout</button></div><div id="draw-p"><div class="G"><label>Harmoniques <span id="hV">50</span></label><input type="range" id="h" min="5" max="300" value="50"></div><div class="G"><label>Vitesse <span id="sV">1.0</span></label><input type="range" id="s" min="1" max="50" value="10"></div><div class="G"><label>Zoom <span id="zV">1.0</span></label><input type="range" id="z" min="10" max="200" value="80"></div><button onclick="P()">‚èØÔ∏è Pause</button><button class="sec" onclick="R()">üóëÔ∏è Reset</button><button onclick="SV()">‚¨áÔ∏è SVG</button><button onclick="AD()">üéµ Audio</button></div><div id="spline-p" class="hid"><div class="G"><label>Tension <span id="teV">0.5</span></label><input type="range" id="te" min="0" max="100" value="50"></div><div class="G"><label>Segments <span id="seV">20</span></label><input type="range" id="se" min="5" max="50" value="20"></div><button onclick="SM()">‚ú® Lisser</button><p style="font-size:10px;color:#667;margin-top:10px">üñ±Ô∏è Glisser pour d√©placer</p></div><div id="fill-p" class="hid"><div class="G"><label>Algo</label><select id="fa"><option value="grad">D√©grad√©</option><option value="knn">KNN</option><option value="wfc">WFC</option><option value="plas">Plasma</option></select></div><div class="G"><label>Teinte 1 <span id="h1V">180</span></label><input type="range" id="h1" min="0" max="360" value="180"></div><div class="G"><label>Teinte 2 <span id="h2V">280</span></label><input type="range" id="h2" min="0" max="360" value="280"></div><div class="G"><label>Densit√© <span id="dV">20</span></label><input type="range" id="d" min="5" max="50" value="20"></div></div><div id="ext-p" class="hid"><div class="drop" onclick="$('f').click()">üì∏ Image<input type="file" id="f" accept="image/*" hidden></div><div class="G" style="margin-top:15px"><label>Seuil <span id="tV">50</span></label><input type="range" id="t" min="0" max="255" value="50"></div><div class="G"><label>Simplification <span id="siV">2.0</span></label><input type="range" id="si" min="1" max="10" value="20"></div><button onclick="PR()">‚ö° Extraire</button></div><div style="margin-top:30px;font-size:10px;color:#556;text-align:center">< 16KB</div></div></div><script>
const $=i=>document.getElementById(i),C=$('c'),X=C.getContext('2d',{alpha:!1}),C2=$('c2'),X2=C2.getContext('2d',{alpha:!1}),W=600,H=600,W2=600,H2=150;
let md='draw',tm=0,pl=1,ID=null,AU=null,AN=null,DA=null,DR=null,L=[{id:0,pt:[],sp:[],fX:[],fY:[],ph:[],ur:[],p:{h:50,s:1,z:.8,fa:'grad',h1:180,h2:280,d:20,t:50,si:2,te:.5,se:20}}],S=0,SA=!1;
for(let i=0;i<20;i++){const a=i/20*Math.PI*2;L[0].pt.push({x:Math.cos(a)*100,y:Math.sin(a)*100})}
SM();UL();
function CL(){return L[S]}
function M(m){md=m;document.querySelectorAll('.tab').forEach(t=>t.classList.remove('act'));event.target.classList.add('act');['draw','spline','fill','ext'].forEach(x=>$(x+'-p').classList.toggle('hid',x!==m))}
function B(i,k,sc=1){$(i).oninput=e=>{const l=CL();l.p[k]=parseFloat(e.target.value)/sc;if($(i+'V'))$(i+'V').textContent=l.p[k];if(k==='h')CF();if(k==='te'||k==='se')SM();if(md==='ext'&&ID)PR()}}
B('h','h');B('s','s',10);B('z','z',100);B('h1','h1');B('h2','h2');B('d','d');B('t','t');B('si','si',10);B('te','te',100);B('se','se');
$('fa').onchange=e=>CL().p.fa=e.target.value;
function UL(){const e=$('ls');e.innerHTML='';L.forEach((l,i)=>{const d=document.createElement('div');d.className='layer'+(i===S?' sel':'');d.innerHTML=`<span>C${i+1}</span><span>${l.pt.length}p</span>`;d.onclick=()=>{S=i;UL();UI()};e.appendChild(d)})}
function UI(){const l=CL(),p=l.p;$('h').value=p.h;$('hV').textContent=p.h;$('s').value=p.s*10;$('sV').textContent=p.s;$('z').value=p.z*100;$('zV').textContent=p.z}
function BZ(p,l){if(p.length<2)return p;const r=[],tn=l.p.te;for(let i=0;i<p.length;i++){const p0=p[i===0?p.length-1:i-1],p1=p[i],p2=p[(i+1)%p.length],p3=p[(i+2)%p.length],m1x=(p2.x-p0.x)*tn,m1y=(p2.y-p0.y)*tn,m2x=(p3.x-p1.x)*tn,m2y=(p3.y-p1.y)*tn;for(let t=0;t<1;t+=1/l.p.se){const t2=t*t,t3=t2*t,h1=2*t3-3*t2+1,h2=-2*t3+3*t2,h3=t3-2*t2+t,h4=t3-t2;r.push({x:h1*p1.x+h2*p2.x+h3*m1x+h4*m2x,y:h1*p1.y+h2*p2.y+h3*m1y+h4*m2y})}}return r}
function SM(){const l=CL();l.sp=BZ(l.pt,l);l.ur=[];l.sp.forEach(p=>{l.ur.push({a:Math.atan2(p.y,p.x),r:Math.sqrt(p.x*p.x+p.y*p.y)})});l.ur.sort((a,b)=>a.a-b.a);CF()}
function FT(v,h){const N=v.length,c=[];for(let k=0;k<h;k++){let re=0,im=0;for(let n=0;n<N;n++){const p=(2*Math.PI*k*n)/N;re+=v[n]*Math.cos(p);im-=v[n]*Math.sin(p)}c.push({re:re/N,im:im/N,fr:k,amp:Math.sqrt(re*re+im*im)/N,ph:Math.atan2(im/N,re/N)})}return c}
function CF(){const l=CL();l.fX=FT(l.sp.map(p=>p.x),l.p.h).sort((a,b)=>b.amp-a.amp);l.fY=FT(l.sp.map(p=>p.y),l.p.h).sort((a,b)=>b.amp-a.amp);l.ph=[];tm=0}
function DE(x,y,r,f,l){for(let i=0;i<f.length;i++){const R=f[i].amp*l.p.z*(AU?1+DA[i%32]/128:1),a=f[i].fr*tm+f[i].ph+r;x+=R*Math.cos(a);y+=R*Math.sin(a);if(md==='draw'&&l===CL()){X.strokeStyle='rgba(255,255,255,0.1)';X.beginPath();X.arc(x-R*Math.cos(a),y-R*Math.sin(a),R,0,Math.PI*2);X.stroke()}}return {x,y}}
function GC(x,y,t,l){const d=Math.sqrt((x-W/2)**2+(y-H/2)**2);switch(l.p.fa){case 'grad':return `hsl(${l.p.h1+(l.p.h2-l.p.h1)*(d/400)},80%,50%)`;case 'knn':return `hsl(${(l.p.h1+Math.floor(x/l.p.d)*l.p.d)%360},70%,50%)`;case 'wfc':return `hsl(${l.p.h1+Math.sin(x*.02+t)*Math.cos(y*.02+t)*100},80%,50%)`;case 'plas':return `hsl(${l.p.h1+(Math.sin(x*.01+t)+Math.sin(y*.01+t))*60},80%,50%)`}}
function TA(){SA=!SA}
function D(){if(AU)AN.getByteFrequencyData(DA);X.fillStyle='#000';X.fillRect(0,0,W,H);if(md==='ext'&&ID)X.putImageData(ID,0,0);L.forEach(l=>{const S=l===CL();if(!SA&&!S)return;const vx=DE(W/2,100,0,l.fX,l),vy=DE(100,H/2,Math.PI/2,l.fY,l),v={x:vx.x,y:vy.y};l.ph.unshift(v);if(l.ph.length>1000)l.ph.pop();if(md==='fill'&&(S||SA)){const s=l.p.d;X.save();X.beginPath();if(l.ph.length>0){X.moveTo(l.ph[0].x,l.ph[0].y);for(let p of l.ph)X.lineTo(p.x,p.y)}X.closePath();X.clip();if(!S&&SA){X.fillStyle=`hsl(${l.p.h1},70%,30%)`;X.fillRect(0,0,W,H)}else{for(let x=0;x<W;x+=s)for(let y=0;y<H;y+=s){X.fillStyle=GC(x,y,tm,l);X.fillRect(x,y,s,s)}}X.restore()}if(md==='spline'&&S){X.fillStyle='#f0f';l.pt.forEach(p=>{X.beginPath();X.arc(p.x+W/2,p.y+H/2,4,0,Math.PI*2);X.fill()});X.strokeStyle='#f0f';X.beginPath();if(l.pt.length>0){X.moveTo(l.pt[0].x+W/2,l.pt[0].y+H/2);l.pt.forEach(p=>X.lineTo(p.x+W/2,p.y+H/2));X.closePath();X.stroke()}}X.strokeStyle=S?(md==='fill'?'#fff':'#0ff'):`hsl(${l.p.h1},50%,40%)`;X.lineWidth=S?3:1;X.beginPath();for(let i=0;i<l.ph.length;i++)X.lineTo(l.ph[i].x,l.ph[i].y);X.stroke();if(md==='draw'&&S){X.strokeStyle='rgba(255,255,255,0.2)';X.beginPath();X.moveTo(vx.x,vx.y);X.lineTo(v.x,v.y);X.lineTo(vy.x,vy.y);X.stroke()}});const l=CL();X2.fillStyle='#000';X2.fillRect(0,0,W2,H2);X2.strokeStyle='#223';X2.beginPath();for(let i=0;i<W2;i+=50){X2.moveTo(i,0);X2.lineTo(i,H2)}for(let i=0;i<H2;i+=30){X2.moveTo(0,i);X2.lineTo(W2,i)}X2.stroke();if(l.ur.length>0){X2.strokeStyle='#0f8';X2.lineWidth=2;X2.beginPath();l.ur.forEach((p,i)=>{const x=((p.a+Math.PI)/(2*Math.PI))*W2,y=H2-(p.r/150)*H2;if(i===0)X2.moveTo(x,y);else X2.lineTo(x,y)});X2.stroke()}const tn=(tm%(2*Math.PI))/(2*Math.PI),sx=(tn<0?1+tn:tn)*W2;X2.strokeStyle='#f0f';X2.lineWidth=2;X2.beginPath();X2.moveTo(sx,0);X2.lineTo(sx,H2);X2.stroke()}
function A(){if(pl){tm+=(2*Math.PI)/CL().fX.length*CL().p.s;D()}requestAnimationFrame(A)}
$('f').onchange=e=>{const f=e.target.files[0],r=new FileReader();r.onload=v=>{const i=new Image();i.onload=()=>{const c=document.createElement('canvas'),s=Math.min(600/i.width,600/i.height);c.width=i.width*s;c.height=i.height*s;const x=c.getContext('2d');x.drawImage(i,0,0,c.width,c.height);ID=x.getImageData(0,0,c.width,c.height);PR()};i.src=v.target.result};r.readAsDataURL(f)}
function AL(p=[]){const o={...L[0].p};o.h1=Math.floor(Math.random()*360);o.h2=(o.h1+100)%360;L.push({id:L.length,pt:p,sp:[],fX:[],fY:[],ph:[],ur:[],p:o});S=L.length-1;if(p.length>0)SM();UL();UI()}
function DL(){if(L.length>1){L.splice(S,1);S=Math.max(0,S-1);UL();UI()}}
function RP(p,e){if(p.length<3)return p;let m=0,k=0;for(let i=1;i<p.length-1;i++){const d=PD(p[i],p[0],p[p.length-1]);if(d>m){m=d;k=i}}if(m>e){const r1=RP(p.slice(0,k+1),e),r2=RP(p.slice(k),e);return r1.slice(0,r1.length-1).concat(r2)}return[p[0],p[p.length-1]]}
function PD(p,a,b){return Math.abs((b.y-a.y)*p.x-(b.x-a.x)*p.y+b.x*a.y-b.y*a.x)/Math.sqrt((b.y-a.y)**2+(b.x-a.x)**2)}
function PR(){if(!ID)return;const d=ID.data,w=ID.width,h=ID.height,g=new Uint8Array(w*h),b=new Uint8Array(w*h),e=new Uint8Array(w*h);for(let i=0;i<w*h;i++)g[i]=(d[i*4]+d[i*4+1]+d[i*4+2])/3;const gk=[1,2,1,2,4,2,1,2,1];for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++){let s=0;for(let ky=-1;ky<=1;ky++)for(let kx=-1;kx<=1;kx++)s+=g[(y+ky)*w+(x+kx)]*gk[(ky+1)*3+(kx+1)];b[y*w+x]=s/16}const gx=[-1,0,1,-2,0,2,-1,0,1],gy=[-1,-2,-1,0,0,0,1,2,1];for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++){let sx=0,sy=0;for(let ky=-1;ky<=1;ky++)for(let kx=-1;kx<=1;kx++){const v=b[(y+ky)*w+(x+kx)];sx+=v*gx[(ky+1)*3+(kx+1)];sy+=v*gy[(ky+1)*3+(kx+1)]}e[y*w+x]=Math.sqrt(sx*sx+sy*sy)>CL().p.t?255:0}const v=new Uint8Array(w*h),ps=[];for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++)if(e[y*w+x]&&!v[y*w+x]){const p=[],s=[{x,y}];v[y*w+x]=1;while(s.length){const c=s.pop();p.push({x:c.x-w/2,y:c.y-h/2});for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++){if(dx===0&&dy===0)continue;const nx=c.x+dx,ny=c.y+dy;if(nx>=0&&nx<w&&ny>=0&&ny<h&&e[ny*w+nx]&&!v[ny*w+nx]){v[ny*w+nx]=1;s.push({x:nx,y:ny})}}}if(p.length>50)ps.push(p)}if(L.length===1&&L[0].pt.length<3)L=[];ps.sort((a,b)=>b.length-a.length).slice(0,5).forEach(p=>{AL(RP(p,CL().p.si))});if(L.length===0)AL();S=0;UL();SA=!0;ID=null}
C.onmousedown=e=>{if(md!=='spline')return;const r=C.getBoundingClientRect(),x=(e.clientX-r.left)*(W/r.width)-W/2,y=(e.clientY-r.top)*(H/r.height)-H/2,l=CL();DR=l.pt.find(p=>(p.x-x)**2+(p.y-y)**2<100);if(!DR){l.pt.push({x,y});SM()}};C.onmousemove=e=>{if(md!=='spline'||!DR)return;const r=C.getBoundingClientRect();DR.x=(e.clientX-r.left)*(W/r.width)-W/2;DR.y=(e.clientY-r.top)*(H/r.height)-H/2;SM()};C.onmouseup=()=>DR=null;
function P(){pl=!pl}
function R(){L=[{id:0,pt:[],sp:[],fX:[],fY:[],ph:[],ur:[],p:{...CL().p}}];S=0;UL()}
function SV(){const l=CL(),s=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${W} ${H}" style="background:#000"><path d="M ${l.ph.map(p=>`${p.x},${p.y}`).join(' L ')}" fill="none" stroke="#0ff" stroke-width="2"/></svg>`,b=new Blob([s],{type:'image/svg+xml'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='f.svg';a.click()}
async function AD(){if(!AU){try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});AU=new AudioContext();const src=AU.createMediaStreamSource(s);AN=AU.createAnalyser();AN.fftSize=64;src.connect(AN);DA=new Uint8Array(AN.frequencyBinCount)}catch(e){alert('Mic?')}}}
A();
</script></body></html>
